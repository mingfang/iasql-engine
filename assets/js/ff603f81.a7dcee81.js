"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[5105],{3905:(e,t,a)=>{a.d(t,{Zo:()=>p,kt:()=>E});var n=a(7294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function i(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},s=Object.keys(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)a=s[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var o=n.createContext({}),l=function(e){var t=n.useContext(o),a=t;return e&&(a="function"==typeof e?e(t):i(i({},t),e)),a},p=function(e){var t=l(e.components);return n.createElement(o.Provider,{value:t},e.children)},u="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,s=e.originalType,o=e.parentName,p=c(e,["components","mdxType","originalType","parentName"]),u=l(a),m=r,E=u["".concat(o,".").concat(m)]||u[m]||d[m]||s;return a?n.createElement(E,i(i({ref:t},p),{},{components:a})):n.createElement(E,i({ref:t},p))}));function E(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var s=a.length,i=new Array(s);i[0]=m;var c={};for(var o in t)hasOwnProperty.call(t,o)&&(c[o]=t[o]);c.originalType=e,c[u]="string"==typeof e?e:r,i[1]=c;for(var l=2;l<s;l++)i[l]=a[l];return n.createElement.apply(null,i)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},4597:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>o,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>c,toc:()=>l});var n=a(7462),r=(a(7294),a(3905));const s={sidebar_position:4,slug:"/aws_ec2"},i="AWS EC2",c={unversionedId:"sample-queries/aws_ec2",id:"sample-queries/aws_ec2",title:"AWS EC2",description:"Create and update instances",source:"@site/docs/sample-queries/aws_ec2.md",sourceDirName:"sample-queries",slug:"/aws_ec2",permalink:"/docs/next/aws_ec2",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4,slug:"/aws_ec2"},sidebar:"docs",previous:{title:"AWS IAM",permalink:"/docs/next/aws_iam"},next:{title:"AWS RDS",permalink:"/docs/next/aws_rds"}},o={},l=[{value:"Create and update instances",id:"create-and-update-instances",level:2},{value:"Read-only instance metadata",id:"read-only-instance-metadata",level:2}],p={toc:l};function u(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"aws-ec2"},"AWS EC2"),(0,r.kt)("h2",{id:"create-and-update-instances"},"Create and update instances"),(0,r.kt)("p",null,"Install the AWS EC2 module"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM iasql_install('aws_ec2');\n")),(0,r.kt)("p",null,"Create two new EC2 instances associated with the ",(0,r.kt)("inlineCode",{parentName:"p"},"default")," security group. An instance ",(0,r.kt)("inlineCode",{parentName:"p"},"name")," tag is required. ",(0,r.kt)("inlineCode",{parentName:"p"},"resolve:ssm:/aws/service/canonical/ubuntu/server/20.04/stable/current/amd64/hvm/ebs-gp2/ami-id")," resolves to the AMI ID for Ubuntu v20.04 in the corresponding AWS region using existing ",(0,r.kt)("a",{parentName:"p",href:"https://aws.amazon.com/blogs/compute/using-system-manager-parameter-as-an-alias-for-ami-id/"},"AWS SSM parameters for AMIs"),"."),(0,r.kt)("admonition",{type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"AWS uses a different AMI id for the same instance type in each region. If you do not use an AWS SSM parameter described above to resolve the AMI id be sure to find and use the correct AMI id for the corresponding region and instance type.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql",metastring:"TheButton",TheButton:!0},"INSERT INTO instance (ami, instance_type, tags)\n  VALUES ('resolve:ssm:/aws/service/canonical/ubuntu/server/20.04/stable/current/amd64/hvm/ebs-gp2/ami-id', 't2.micro', '{\"name\":\"i-1\"}');\n\nINSERT INTO instance_security_groups (instance_id, security_group_id) SELECT\n  (SELECT id FROM instance WHERE tags ->> 'name' = 'i-1'),\n  (SELECT id FROM security_group WHERE group_name='default' AND vpc_id = (SELECT id FROM vpc WHERE is_default = true));\n\nINSERT INTO instance (ami, instance_type, tags)\n  VALUES ('resolve:ssm:/aws/service/canonical/ubuntu/server/20.04/stable/current/amd64/hvm/ebs-gp2/ami-id', 't2.micro', '{\"name\":\"i-2\"}');\n\nINSERT INTO instance_security_groups (instance_id, security_group_id) SELECT\n  (SELECT id FROM instance WHERE tags ->> 'name' = 'i-2'),\n  (SELECT id FROM security_group WHERE group_name='default' AND vpc_id = (SELECT id FROM vpc WHERE is_default = true));\n")),(0,r.kt)("p",null,(0,r.kt)("button",{className:"button button--primary button--lg margin-bottom--lg",onClick:()=>{Cookies.set("26a8382594efdb9b0eedf5e0c7ab880d1a35bde0ac26830fb3333bfe1efc857f",LZString.compressToBase64("INSERT%20INTO%20instance%20%28ami%2C%20instance_type%2C%20tags%29%0A%20%20VALUES%20%28%27resolve%3Assm%3A%2Faws%2Fservice%2Fcanonical%2Fubuntu%2Fserver%2F20.04%2Fstable%2Fcurrent%2Famd64%2Fhvm%2Febs-gp2%2Fami-id%27%2C%20%27t2.micro%27%2C%20%27%7B%22name%22%3A%22i-1%22%7D%27%29%3B%0A%0AINSERT%20INTO%20instance_security_groups%20%28instance_id%2C%20security_group_id%29%20SELECT%0A%20%20%28SELECT%20id%20FROM%20instance%20WHERE%20tags%20-%3E%3E%20%27name%27%20%3D%20%27i-1%27%29%2C%0A%20%20%28SELECT%20id%20FROM%20security_group%20WHERE%20group_name%3D%27default%27%20AND%20vpc_id%20%3D%20%28SELECT%20id%20FROM%20vpc%20WHERE%20is_default%20%3D%20true%29%29%3B%0A%0AINSERT%20INTO%20instance%20%28ami%2C%20instance_type%2C%20tags%29%0A%20%20VALUES%20%28%27resolve%3Assm%3A%2Faws%2Fservice%2Fcanonical%2Fubuntu%2Fserver%2F20.04%2Fstable%2Fcurrent%2Famd64%2Fhvm%2Febs-gp2%2Fami-id%27%2C%20%27t2.micro%27%2C%20%27%7B%22name%22%3A%22i-2%22%7D%27%29%3B%0A%0AINSERT%20INTO%20instance_security_groups%20%28instance_id%2C%20security_group_id%29%20SELECT%0A%20%20%28SELECT%20id%20FROM%20instance%20WHERE%20tags%20-%3E%3E%20%27name%27%20%3D%20%27i-2%27%29%2C%0A%20%20%28SELECT%20id%20FROM%20security_group%20WHERE%20group_name%3D%27default%27%20AND%20vpc_id%20%3D%20%28SELECT%20id%20FROM%20vpc%20WHERE%20is_default%20%3D%20true%29%29%3B"),{expires:1,domain:"localhost"==window.location.hostname?"localhost":"iasql.com"}),window.open("https://app.iasql.com/#/button/26a8382594efdb9b0eedf5e0c7ab880d1a35bde0ac26830fb3333bfe1efc857f","_blank")}},"Run SQL")),(0,r.kt)("p",null,"Apply changes"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM iasql_apply();\n")),(0,r.kt)("p",null,"Query newly created instances. View the table schema ",(0,r.kt)("a",{parentName:"p",href:"https://dbdocs.io/iasql/iasql?table=instance&schema=public&view=table_structure"},"here")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT *\nFROM instance\nWHERE tags ->> 'name' = 'i-1' OR\ntags ->> 'name' = 'i-2';\n")),(0,r.kt)("p",null,"Get an instance count"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT COUNT(*)\nFROM instance;\n")),(0,r.kt)("p",null,"Change the instance to the AWS Linux AMI for the previously created ",(0,r.kt)("inlineCode",{parentName:"p"},"i-1")," instance. This will trigger a recreate so the existing instance will be terminated and a new one will be created when ",(0,r.kt)("inlineCode",{parentName:"p"},"iasql_apply")," is called."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"UPDATE instance SET ami = 'resolve:ssm:/aws/service/ami-amazon-linux-latest/amzn2-ami-hvm-x86_64-gp2' WHERE tags ->> 'name' = 'i-1';\nSELECT * FROM iasql_apply();\n")),(0,r.kt)("h2",{id:"read-only-instance-metadata"},"Read-only instance metadata"),(0,r.kt)("p",null,"Install the AWS EC2 module"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT * FROM iasql_install('aws_ec2_metadata');\n")),(0,r.kt)("p",null,"View the metadata for the previously created ",(0,r.kt)("inlineCode",{parentName:"p"},"i-1")," instance. View the table schema ",(0,r.kt)("a",{parentName:"p",href:"https://dbdocs.io/iasql/iasql?table=instance_metadata&schema=public&view=table_structure"},"here")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sql"},"SELECT *\nFROM instance_metadata\nWHERE instance_id = (\n  SELECT instance_id\n  FROM instance\n  WHERE tags ->> 'name' = 'i-1'\n);\n")))}u.isMDXComponent=!0}}]);