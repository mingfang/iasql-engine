<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>IaSQL Blog</title>
        <link>https://iasql.com/blog</link>
        <description>IaSQL Blog</description>
        <lastBuildDate>Wed, 23 Nov 2022 00:00:00 GMT</lastBuildDate>
        <docs>https://validator.w3.org/feed/docs/rss2.html</docs>
        <generator>https://github.com/jpmonette/feed</generator>
        <language>en</language>
        <item>
            <title><![CDATA[Deploy Ghost in EC2 with one click]]></title>
            <link>https://iasql.com/blog/deploy-ghost-ec2</link>
            <guid>deploy-ghost-ec2</guid>
            <pubDate>Wed, 23 Nov 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[Ghost is a powerful app for new-media creators to publish, share, and grow a business around their content. It comes with modern tools to build a website, publish content, send newsletters & offer paid]]></description>
            <content:encoded><![CDATA[<p>Ghost is a powerful app for new-media creators to publish, share, and grow a business around their content. It comes with modern tools to build a website, publish content, send newsletters &amp; offer paid
subscriptions to members.</p><p>Ghost is a software as a service product, but it is built totally on open source and offers a self-hosted, self-serve version. This version can be hosted on AWS using several approaches, and one of them.</p><p>Starting an EC2 instance and manually triggering the installation commands is a procedure that can be done manually, but there are also another dependencies involved, such as the creation of proper security groups.
It is time-consuming task, specially if you need to install several instances. This article will offer a way to install Ghost with one-click on IaSQL using an EC2 instance on Ubuntu as highlighted <a href="https://ghost.org/docs/install/ubuntu/" target="_blank" rel="noopener noreferrer">here</a>.</p><p>_This approach uses <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html" target="_blank" rel="noopener noreferrer">EC2 user data</a> functionality - to run an startup script that will configure Ghost
as soon as the instance is started - and <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/instancedata-data-retrieval.html" target="_blank" rel="noopener noreferrer">EC2 instance metadata</a> - to retrieve
the public IP of the instance, and assign it dynamically to Ghost installation script.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="pre-requisites">Pre-requisites<a class="hash-link" href="#pre-requisites" title="Direct link to heading">​</a></h2><p>This post is going to rely on EC2 to install the Ghost content. In order to access to the instance, it is recommended to setup an SSH key, to be able to access it later for modifications and maintenance. So we will be generating some keys
and importing them to later associate with the EC2 instance. If you do not have an existing key, please generate one. The output of the public key will be the one imported into the system:</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain">ssh-keygen -t rsa -f /tmp/key</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token assign-left variable" style="color:rgb(201, 103, 101)">PUBKEY</span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token variable" style="color:rgb(201, 103, 101)">$(</span><span class="token variable function" style="color:rgb(153, 76, 195);font-style:italic">cat</span><span class="token variable" style="color:rgb(201, 103, 101)"> /tmp/key.pub</span><span class="token variable" style="color:rgb(201, 103, 101)">)</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The public key will be then imported into the system:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- Install modules</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  iasql_install </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">'aws_ec2'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'aws_ec2_metadata'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- Request a keypair</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> key_pair_import </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">'ghost'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'&lt;your_pubkey_content&gt;'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'us-east-2'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><button class="button button--primary button--lg margin-bottom--lg">Import keypair</button></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="ghost-installation">Ghost installation<a class="hash-link" href="#ghost-installation" title="Direct link to heading">​</a></h2><p>After the keypair has been imported, we can proceed with the installation of the instance itself, associating the created key to allow SSH access after it is created.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- start transaction</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> iasql_begin</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- insert security groups</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  security_group </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">description</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> group_name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">VALUES</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">'Ghost security group'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'ghost_sg'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  security_group_rule </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">is_egress</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> ip_protocol</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> from_port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> to_port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> cidr_ipv4</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> description</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> security_group_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  t</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">is_egress</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  t</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">ip_protocol</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  t</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">from_port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  t</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">to_port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  t</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">cidr_ipv4::cidr</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  t</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">description</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  security_group</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  security_group</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">VALUES</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token boolean" style="color:rgb(188, 84, 84)">FALSE</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'tcp'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">22</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">22</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'0.0.0.0/0'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'ghost_sg_rule_ssh'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token boolean" style="color:rgb(188, 84, 84)">FALSE</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'tcp'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">80</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">80</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'0.0.0.0/0'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'ghost_sg_rule_http'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token boolean" style="color:rgb(188, 84, 84)">FALSE</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'tcp'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">443</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">443</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'0.0.0.0/0'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'ghost_sg_rule_https'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token boolean" style="color:rgb(188, 84, 84)">TRUE</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'tcp'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">65535</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'0.0.0.0/0'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'ghost_sg_rule_egress'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">AS</span><span class="token plain"> t </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">is_egress</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> ip_protocol</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> from_port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> to_port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> cidr_ipv4</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> description</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  security_group</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">group_name </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'ghost_sg'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- insert instance with the right userdata</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  instance </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">ami</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> instance_type</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> subnet_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> tags</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> user_data</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> key_pair_name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> region</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token string" style="color:rgb(72, 118, 214)">'resolve:ssm:/aws/service/canonical/ubuntu/server/22.04/stable/current/amd64/hvm/ebs-gp2/ami-id'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token string" style="color:rgb(72, 118, 214)">'t2.small'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  subnet</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token string" style="color:rgb(72, 118, 214)">'{"name":"ghost-blog"}'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token string" style="color:rgb(72, 118, 214)">'#!/bin/bash</span><br></span><span class="token-line" style="color:#403f53"><span class="token string" style="color:rgb(72, 118, 214)">useradd -m ghostuser</span><br></span><span class="token-line" style="color:#403f53"><span class="token string" style="color:rgb(72, 118, 214)">usermod -a -G sudo ghostuser</span><br></span><span class="token-line" style="color:#403f53"><span class="token string" style="color:rgb(72, 118, 214)">echo "ghostuser ALL=(ALL:ALL) NOPASSWD: ALL" | sudo tee /etc/sudoers.d/ghostuser</span><br></span><span class="token-line" style="color:#403f53"><span class="token string" style="color:rgb(72, 118, 214)">sudo -E apt-get update -y</span><br></span><span class="token-line" style="color:#403f53"><span class="token string" style="color:rgb(72, 118, 214)">sudo -E apt-get upgrade -y</span><br></span><span class="token-line" style="color:#403f53"><span class="token string" style="color:rgb(72, 118, 214)">sudo -E apt-get -y install nginx</span><br></span><span class="token-line" style="color:#403f53"><span class="token string" style="color:rgb(72, 118, 214)">sudo -E ufw allow "Nginx Full"</span><br></span><span class="token-line" style="color:#403f53"><span class="token string" style="color:rgb(72, 118, 214)">sudo -E apt-get -y install mysql-server</span><br></span><span class="token-line" style="color:#403f53"><span class="token string" style="color:rgb(72, 118, 214)">sudo -E mysql -u root -e "ALTER USER "root"@"localhost" IDENTIFIED WITH mysql_native_password BY \"ghost\";"</span><br></span><span class="token-line" style="color:#403f53"><span class="token string" style="color:rgb(72, 118, 214)">curl -sL https://deb.nodesource.com/setup_16.x | sudo -E bash</span><br></span><span class="token-line" style="color:#403f53"><span class="token string" style="color:rgb(72, 118, 214)">sudo -E apt-get -y install nodejs</span><br></span><span class="token-line" style="color:#403f53"><span class="token string" style="color:rgb(72, 118, 214)">sudo npm install ghost-cli@latest -g</span><br></span><span class="token-line" style="color:#403f53"><span class="token string" style="color:rgb(72, 118, 214)">sudo -E mkdir -p /var/www/ghost</span><br></span><span class="token-line" style="color:#403f53"><span class="token string" style="color:rgb(72, 118, 214)">sudo -E chown ghostuser /var/www/ghost</span><br></span><span class="token-line" style="color:#403f53"><span class="token string" style="color:rgb(72, 118, 214)">sudo chmod 775 /var/www/ghost</span><br></span><span class="token-line" style="color:#403f53"><span class="token string" style="color:rgb(72, 118, 214)">cd /var/www/ghost/</span><br></span><span class="token-line" style="color:#403f53"><span class="token string" style="color:rgb(72, 118, 214)">sudo -u ghostuser ghost install --url http://$(curl http://169.254.169.254/latest/meta-data/public-ipv4) --db mysql --dbpass ghost --no-prompt --start --enable</span><br></span><span class="token-line" style="color:#403f53"><span class="token string" style="color:rgb(72, 118, 214)">'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'ghost'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token string" style="color:rgb(72, 118, 214)">'us-east-2'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  subnet</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token keyword" style="color:rgb(12, 150, 155)">INNER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">JOIN</span><span class="token plain"> vpc </span><span class="token keyword" style="color:rgb(12, 150, 155)">ON</span><span class="token plain"> vpc</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> subnet</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">vpc_id</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> vpc</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">is_default </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'Y'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  vpc</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">region </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'us-east-2'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> subnet</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">availability_zone </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'us-east-2a'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">LIMIT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- insert instance security groups</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  instance_security_groups </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">instance_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> security_group_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      id</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      instance</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      tags </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'name'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'ghost-blog'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">LIMIT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      id</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      security_group</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      group_name </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'ghost_sg'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token operator" style="color:rgb(12, 150, 155)">AND</span><span class="token plain"> region </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'us-east-2'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">LIMIT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  iasql_commit</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><button class="button button--primary button--lg margin-bottom--lg">Install Ghost</button></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="accessing-ghost">Accessing Ghost<a class="hash-link" href="#accessing-ghost" title="Direct link to heading">​</a></h2><p>After the process finishes (it will take over 10-15 minutes), you will have your Ghost instance installed, publicly accessible through the public IP of the spinned instance.
You can get the details of the public IP of your instance querying for the metadata:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  public_ip_address</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  instance_metadata</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  id </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      id</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      instance</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      tags </span><span class="token operator" style="color:rgb(12, 150, 155)">-</span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'name'</span><span class="token plain"> </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'ghost-blog'</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">LIMIT</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">      </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The initial Ghost installation will be available on the browser just query by <code>http://&lt;public_ip_address&gt;/ghost</code>:</p><img loading="lazy" src="/img/configure_ghost.png" style="max-width:600px" class="img_ev3q"><p>This is the basic installation of Ghost, but it is just meant for development and testing purposes. Once you are satisfied with the setup,
you can continue to an advanced deployment of Ghost meant for production. This will come in a follow-up post from IaSQL.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Deploying to ECS, Simplified!]]></title>
            <link>https://iasql.com/blog/ecs-simplified</link>
            <guid>ecs-simplified</guid>
            <pubDate>Fri, 04 Nov 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[If you have ever tried to deploy your containerized application to ECS, you know that it's not going to be an easy click-to-deploy journey. In order to get your application up and running on ECS, you have to go through a bunch of resource creation. You'll need to:]]></description>
            <content:encoded><![CDATA[<p>If you have ever tried to deploy your containerized application to ECS, you know that it's not going to be an easy click-to-deploy journey. In order to get your application up and running on ECS, you have to go through a bunch of resource creation. You'll need to:</p><ul><li>Deploy a load balancer as the point-of-contact for your app</li><li>Create a target group for the load balancer and register the ECS tasks in it</li><li>Add a new listener to your load balancer and connect it to the target group</li><li>Create a security group, and you need to allow the port your app is listening on in that security group</li><li>Attach the security group above to your load balancer</li><li>Create a CloudWatch log group for your ECS task</li><li>Create an ECS cluster, and definitely the task definition as well</li><li>Oh, and create an ECR repository to push your images to be run on the container</li></ul><p>I'm not going to continue this long list, since I've already got a headache. Doing those steps manually is going to give you a headache as well, so why bother doing all those steps yourself and risking different errors you might face when deploying your containerized app? You don't really have the time for the random IAM-related errors AWS is demanding you to resolve. Besides, you already have your codebase ready and the <code>Dockerfile</code> is there, so why not just run a simple command doing something that should be simply done?</p><p>In this post, we're going to discover an IaSQL module that's built to make deploying to ECS, simplified. Most of the details for deploying a container to ECS are the same (load balancers, security groups, IAM roles, etc), and we have created the <code>aws_ecs_simplified</code> module for you so that you can give it any Github repo with a <code>Dockerfile</code> and get your app deployed to ECS in the fastest time possible, with scalability available! All the needed resources are going to be created automatically in your AWS account, and you'll have the full access to the details while you're gaining the benefit of a higher-level simple deployment.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="-an-example-usage-of-the-aws_ecs_simplified-module-"><strong> An Example Usage of the <code>aws_ecs_simplified</code> Module </strong><a class="hash-link" href="#-an-example-usage-of-the-aws_ecs_simplified-module-" title="Direct link to heading">​</a></h2><p>Let's say we are going to deploy <a href="https://github.com/iasql/iasql-engine/tree/main/examples/ecs-fargate/prisma/app" target="_blank" rel="noopener noreferrer">this simple Express.js app</a> to the ECS. It has a <code>Dockerfile</code> and <code>package.json</code> that installs <code>express</code> on <code>npm install</code>. <code>npm start</code> then starts the Express server which listens on port <code>8088</code>.</p><div class="theme-admonition theme-admonition-note alert alert--secondary admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</div><div class="admonitionContent_S0QG"><p><code>aws_ecs_simplified</code> is a high-level module we have created to make scalable ECS deployments easier. For more info on high-level vs low-level modules, you can check <a href="https://iasql.com/docs/low-level-vs-high-level/" target="_blank" rel="noopener noreferrer">this guide</a>.</p></div></div><p>Let's go and deploy the above app to your AWS account. Don't worry if you don't have an IaSQL database already, you can create one for free when you click the "Deploy Now" button.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockTitle_Ktv7">Deploy a simple Express.js app from a Github repository to ECS</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm"><span class="token-line codeLine_lJS_" style="color:#403f53"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> iasql_install</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">'aws_ecs_simplified'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'aws_codebuild'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#403f53"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"> ecs_simplified</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">app_name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> app_port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> image_tag</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> public_ip</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">VALUES</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#403f53"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token string" style="color:rgb(72, 118, 214)">'simple-express'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#403f53"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token number" style="color:rgb(170, 9, 130)">8088</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#403f53"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token string" style="color:rgb(72, 118, 214)">'latest'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#403f53"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token boolean" style="color:rgb(188, 84, 84)">true</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#403f53"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#403f53"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> iasql_apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#403f53"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain" style="display:inline-block"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#403f53"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> ecr_build</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#403f53"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token string" style="color:rgb(72, 118, 214)">'https://github.com/iasql/iasql-engine/'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- the Github repo URL</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#403f53"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> id</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#403f53"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> repository</span></span><br></span><span class="token-line codeLine_lJS_" style="color:#403f53"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> repository_name </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'simple-express-repository'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain">::</span><span class="token keyword" style="color:rgb(12, 150, 155)">varchar</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">255</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- ECR repo for the image to be pushed</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#403f53"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token string" style="color:rgb(72, 118, 214)">'./examples/ecs-fargate/prisma/app'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- the subdirectory in Github repo</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#403f53"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token string" style="color:rgb(72, 118, 214)">'main'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- the Github branch or ref</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#403f53"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain">  </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- Github personal access token - can be omitted if public repository</span><span class="token plain"></span></span><br></span><span class="token-line codeLine_lJS_" style="color:#403f53"><span class="codeLineNumber_Tfdd"></span><span class="codeLineContent_feaV"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p><button class="button button--primary button--lg margin-bottom--lg">Deploy Now</button></p><p>That's it! Now wait for some time and your app is deployed! While your app is being deployed, let's go through the commands we executed in more depth:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> iasql_install</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token string" style="color:rgb(72, 118, 214)">'aws_ecs_simplified'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'aws_codebuild'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>This command installs the <code>aws_ecs_simplified</code> high-level module. We– at IaSQL– have created that module to make it easy to deploy containerized apps to ECS. The code for it is <a href="https://github.com/iasql/iasql-engine/blob/v0.0.22/src/modules/0.0.23/aws_ecs_simplified/sql/after_install.sql" target="_blank" rel="noopener noreferrer">here</a>. But IaSQL is so flexible that anyone can create their own high-level (and of course, low-level) modules and add it to IaSQL.</li></ul><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"> ecs_simplified</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">app_name</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> app_port</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> image_tag</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> public_ip</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">VALUES</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token string" style="color:rgb(72, 118, 214)">'simple-express'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token number" style="color:rgb(170, 9, 130)">8088</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token string" style="color:rgb(72, 118, 214)">'latest'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token boolean" style="color:rgb(188, 84, 84)">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>This command creates a new <code>ecs_simplified</code> app by inserting a new row into the <code>ecs_simplified</code> table. Seems pretty easy, right? But under the hood, it's creating all the necessary resources like load balancers, security groups, IAM roles, etc.</li><li>You can manually check the tables to see what resources are being created. For example, looking at the <code>load_balancer</code> table you'll see a load balancer named <code>simple-express-load-balancer</code> is inserted automatically by running the above insert command.</li></ul><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> iasql_apply</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>The insert command did create the list for what resources should be created, but they've not yet created on the AWS. You need to call the <code>iasql_apply()</code> function to sync the cloud with the data on your database.</li><li>For more info on the <code>iasql_apply()</code> command, check <a href="https://iasql.com/docs/apply-and-sync/#apply-and-preview_apply" target="_blank" rel="noopener noreferrer">this guide</a> on how it works.</li><li>After running the <code>iasql_apply()</code> function to completion all the necessary resources are now created on the cloud, so their ARNs are populated. You can verify this by looking at different tables, eg. <code>iam_role</code>.</li><li>To get your load balancer address, you can easily run <code>SELECT load_balancer_dns FROM ecs_simplified WHERE app_name = 'simple-express'</code> query and get the URL to access your app.</li><li>Now ECS is waiting for an image to be pushed to your ECR repository to run it. You can get the URI for the ECR repository by running the <code>SELECT repository_uri FROM ecs_simplified WHERE app_name = 'simple-express'</code> query.  You <em>could</em> build your docker image locally and then follow <a href="https://docs.aws.amazon.com/AmazonECR/latest/userguide/getting-started-cli.html" target="_blank" rel="noopener noreferrer">Steps 2 and 4 from this guide</a> to connect your local docker CLI to your ECR repository and push that docker image into your ECR repository, but we have a simpler solution next.</li><li>In the next step, we'll automatically build an image for the code in Github repo and then push it to this URI (all through SQL and using another high-level function named <code>ecr_build</code>).</li></ul><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> ecr_build</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token string" style="color:rgb(72, 118, 214)">'https://github.com/iasql/iasql-engine/'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- the Github repo URL</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> id</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> repository</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> repository_name </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'simple-express-repository'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain">::</span><span class="token keyword" style="color:rgb(12, 150, 155)">varchar</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token number" style="color:rgb(170, 9, 130)">255</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- ECR repo for the image to be pushed</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token string" style="color:rgb(72, 118, 214)">'./examples/ecs-fargate/prisma/app'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- the subdirectory in Github repo</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token string" style="color:rgb(72, 118, 214)">'main'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain">  </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- the Github branch or ref</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">  </span><span class="token boolean" style="color:rgb(188, 84, 84)">NULL</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- Github personal access token - can be omitted if public repository</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ul><li>This command tells IaSQL to go clone <code>iasql-engine</code> repository, build an image on the subdirectory specified, and then push it to the ECR repository created earlier by the <code>aws_ecs_simplified</code> module. Running the above command will automatically create a CodeBuild project and the related roles, etc. Then it'll start a build, and after it's successful all the created resources are deleted to ensure there won't be any additional charges to your AWS account.</li><li>To access your app on the cloud, get the load balancer address and use your browser to access the live version of it:</li></ul><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> load_balancer_dns</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> ecs_simplified</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> app_name </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'simple-express'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Then you can check if the server is running on the <code>&lt;load_balancer_dns value&gt;:8088/health</code> address.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="low-level-access-to-resources">Low-level Access to Resources<a class="hash-link" href="#low-level-access-to-resources" title="Direct link to heading">​</a></h2><p>So the <code>aws_ecs_simplified</code> module simplifies things, right? But what if you still need the level of control you had when you were doing all the steps manually? The traditional PaaS trade-off is that you can't grow your app beyond the built-in limitations as you don't have access to all the small details. The IaSQL approach is not limited in that way.</p><p>Let's say you want your ECS container to be able to use the AWS CLI to provision an EC2 instance, and for that purpose its IAM role needs <code>AmazonEC2FullAccess</code> policy to work properly. <code>aws_ecs_simplified</code> does not have a column to configure such a thing, but that doesn't mean we're stuck.</p><p>The good news is that you still have the full control over all resources in the deepest details. Let's fix your app's IAM role access by attaching the needed policy to its IAM role:</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">UPDATE</span><span class="token plain"> iam_role</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SET</span><span class="token plain"> attached_policies_arns </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> attached_policies_arns </span><span class="token operator" style="color:rgb(12, 150, 155)">||</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">                             </span><span class="token string" style="color:rgb(72, 118, 214)">'arn:aws:iam::aws:policy/AmazonEC2FullAccess'</span><span class="token plain"> </span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">-- attached_policies_arns is of text[] type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> role_name </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'simple-express-ecs-task-exec-role'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You want additional rules for the container's security group? No problem! Just write the SQL and execute it, and it will be applied to the cloud within seconds. You want 3 copies of your container to be kept running with a round-robin load balancing on them? It's already there, just do an <code>UPDATE ecs_simplified SET desired_count = 3 WHERE app_name = 'simple_express';</code> and it's there for you.</p><p>With IaSQL and its flexibility, you can benefit from both the high-level and low-level operations. We have created the <code>aws_ecs_simplified</code> module to show the flexibility and power of IaSQL engine, but the possibilities are endless. IaSQL is also an open-source project, meaning that you can use the powerful IaSQL engine and build your own modules on top of that. If you're into the idea of empowering other developers to do complex infrastructure tasks simply, why don't you take a look at our <a href="https://github.com/iasql/iasql-engine/blob/main/CONTRIBUTING.md" target="_blank" rel="noopener noreferrer">contributing guide</a> and join our <a href="https://discord.com/invite/machGGczea" target="_blank" rel="noopener noreferrer">Discord channel</a>? We'll thoroughly answer any of your question regarding the usage or development of IaSQL. Looking forward to seeing you in our small, but great community.</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[UPDATE iasql SET source = 'open';]]></title>
            <link>https://iasql.com/blog/os-iasql</link>
            <guid>os-iasql</guid>
            <pubDate>Thu, 14 Apr 2022 00:00:00 GMT</pubDate>
            <description><![CDATA[We are excited to announce that IaSQL is now open source! The main repository is under https://github.com/iasql/iasql-engine. As perfectionists, we feel like IaSQL will never be truly ready. However, we believe IaSQL is at the point where it can start to be useful for developers managing infrastructure in the cloud. IaSQL is a SaaS that lets you model your infrastructure as data by maintaining a 2-way connection between your AWS account and a Postgres SQL database to represent the definitive state (and status) of your cloud which cannot be achieved with a static infrastructure declaration. This means that when you connect an AWS account to an IaSQL instance it automatically backfills the database with your existing cloud resources. No need to painstakingly redefine or reconcile your existing infrastructure, and IaSQL's module system means you can specify which parts of your cloud infrastructure you wish to control.]]></description>
            <content:encoded><![CDATA[<p>We are excited to announce that <a href="https://iasql.com" target="_blank" rel="noopener noreferrer">IaSQL</a> is now open source! The main repository is under <a href="https://github.com/iasql/iasql-engine" target="_blank" rel="noopener noreferrer">https://github.com/iasql/iasql-engine</a>. As perfectionists, we feel like IaSQL will never be truly ready. However, we believe IaSQL is at the point where it can start to be useful for developers managing infrastructure in the cloud. IaSQL is a SaaS that lets you model your infrastructure as data by maintaining a 2-way connection between your AWS account and a Postgres SQL database to represent the definitive state (and status) of your cloud which cannot be achieved with a static infrastructure declaration. This means that when you connect an AWS account to an IaSQL instance it automatically backfills the database with your existing cloud resources. No need to painstakingly redefine or reconcile your existing infrastructure, and IaSQL's <a href="https://docs.iasql.com/module/" target="_blank" rel="noopener noreferrer">module system</a> means you can specify which parts of your cloud infrastructure you wish to control.</p><img src="/img/iasql-connector.gif" alt="Dashboard" class="themedImage_ToTc themedImage--light_HNdA" style="height:25rem"><img src="/img/iasql-connector_dark.gif" alt="Dashboard" class="themedImage_ToTc themedImage--dark_i4oU" style="height:25rem"><p>IaSQL also makes it possible to express infrastructure changes as code that can be version controlled. This can be done with any <a href="https://en.wikipedia.org/wiki/Schema_migration" target="_blank" rel="noopener noreferrer">migration system</a> for schema and data changes, or in a script using <a href="https://www.prisma.io/dataguide/postgresql/inserting-and-modifying-data/insert-on-conflict" target="_blank" rel="noopener noreferrer">idempotent SQL inserts</a> more akin to <a href="https://en.wikipedia.org/wiki/Infrastructure_as_code" target="_blank" rel="noopener noreferrer">IaC</a>.</p><p>PostgreSQL IaSQL databases can be provisioned and configured via our <a href="https://app.iasql.com" target="_blank" rel="noopener noreferrer">dashboard</a>. The dashboard calls the <a href="https://github.com/iasql/iasql-engine" target="_blank" rel="noopener noreferrer">engine</a> which is a Node.js server written in Typescript that provisions unmodified PostgreSQL instances loaded with tables representing AWS services controlled via the <a href="https://www.npmjs.com/package/aws-sdk" target="_blank" rel="noopener noreferrer">AWS SDK</a>. AWS is our main focus at the moment, but we plan to support GCP, Azure and other cloud providers soon. This is an <a href="https://github.com/iasql/iasql-engine#cloud-providers" target="_blank" rel="noopener noreferrer">updated list</a> of the AWS services that we currently support. Let us know if you need a specific AWS service and we should be able prioritize it!</p><img loading="lazy" class="screenshot" src="/screenshots/dashboard.png"><p>We want to make it easier to write IaSQL modules, reduce waiting times when provisioning infrastructure, add more functionality to the existing AWS services, and so on. The list of things we want to build into IaSQL is long, but we want to do it in the open with your feedback and help. Drop us a line on <a href="https://discord.com/invite/machGGczea" target="_blank" rel="noopener noreferrer">Discord</a>!</p>]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Introduction to Infrastructure as SQL]]></title>
            <link>https://iasql.com/blog/intro-iasql</link>
            <guid>intro-iasql</guid>
            <pubDate>Tue, 14 Sep 2021 00:00:00 GMT</pubDate>
            <description><![CDATA[What software you have deployed on what services and the interactions between them and the outside world is not a program, it is information about your infrastructure. Changing your infrastructure is a set of operations to perform, a program. A SQL database is a set of information and SQL queries read or change that data.]]></description>
            <content:encoded><![CDATA[<p>What software you have deployed on what services and the interactions between them and the outside world is not a program, it is information about your infrastructure. Changing your infrastructure&nbsp;<em>is</em>&nbsp;a set of operations to perform, a program. A SQL database is a set of information and SQL queries read or change that data.</p><p><strong>Infrastructure State is Data, Infrastructure Change is Code. It's as simple as that.</strong></p><p>And manipulating your infrastructure in this way is natural.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">INSERT</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">INTO</span><span class="token plain"> aws_ec2 </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">ami_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> ec2_instance_type_id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> ami</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">id</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> ait</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> ec2_instance_type </span><span class="token keyword" style="color:rgb(12, 150, 155)">as</span><span class="token plain"> ait</span><span class="token punctuation" style="color:rgb(153, 76, 195)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> id</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain">   amis</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain">  image_name </span><span class="token operator" style="color:rgb(12, 150, 155)">LIKE</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'amzn-ami-hvm-%'</span><span class="token keyword" style="color:rgb(12, 150, 155)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">BY</span><span class="token plain"> creation_date </span><span class="token keyword" style="color:rgb(12, 150, 155)">DESC</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain">    </span><span class="token keyword" style="color:rgb(12, 150, 155)">LIMIT</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">1</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">as</span><span class="token plain"> ami</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain">  ait</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">instance_name </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'t2.micro'</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="relations-and-types-matter-for-infrastructure"><strong>Relations and Types Matter for Infrastructure</strong><a class="hash-link" href="#relations-and-types-matter-for-infrastructure" title="Direct link to heading">​</a></h2><p>Infrastructure as Code solutions do not have a good way of encoding dependencies across infrastructure pieces in a micro services architecture which makes it really hard to make and revert changes to infrastructure.</p><p>Representing your infrastructure as SQL resolves the primary issue of YAML-based infrastructure tools by making the relations between pieces of your infrastructure first-class citizens, and enforcing type safety on the data and changes to it.</p><p>You can't set the EC2 instance type as&nbsp;<code>t2.mucro</code>&nbsp;and have your deploy system try and fail to create such an instance. The&nbsp;<code>insert</code>&nbsp;statement will fail and tell you zero rows were inserted and you can quickly see why.</p><p>Similarly, if you have a record in the&nbsp;<code>security_group</code>&nbsp;table, you can't delete it if there are any references to it in the&nbsp;<code>ec2_security_groups</code>&nbsp;join table. The relational structure of IaSQL prevents you from putting your infrastructure into an invalid state.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="new-powers-explore-query-and-automate-your-infrastructure"><strong>New Powers: Explore, Query, and Automate Your Infrastructure</strong><a class="hash-link" href="#new-powers-explore-query-and-automate-your-infrastructure" title="Direct link to heading">​</a></h2><p>Because your infrastructure is presented as a SQL database, you can connect to it with a SQL client of your choice and explore what you have and what the possibilities are.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">SHOW</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">tables</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>You can query for unusual usage patterns.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> aws_ec2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> aws_ec2</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">INNER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">JOIN</span><span class="token plain"> ec2_instance_type </span><span class="token keyword" style="color:rgb(12, 150, 155)">AS</span><span class="token plain"> ait </span><span class="token keyword" style="color:rgb(12, 150, 155)">ON</span><span class="token plain"> ait</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> aws_ec2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">ec2_instance_type_id</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> ait</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">vcpus </span><span class="token operator" style="color:rgb(12, 150, 155)">&gt;</span><span class="token plain"> </span><span class="token number" style="color:rgb(170, 9, 130)">8</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">BY</span><span class="token plain"> ait</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">vcpus </span><span class="token keyword" style="color:rgb(12, 150, 155)">DESC</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And since it is a database, you can create your own tables with their own meaning and associate them with your infrastructure.</p><div class="language-sql codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-sql codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">SELECT</span><span class="token plain"> aws_ec2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token operator" style="color:rgb(12, 150, 155)">*</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">FROM</span><span class="token plain"> aws_ec2</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">INNER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">JOIN</span><span class="token plain"> company_team_ec2s </span><span class="token keyword" style="color:rgb(12, 150, 155)">AS</span><span class="token plain"> cte </span><span class="token keyword" style="color:rgb(12, 150, 155)">ON</span><span class="token plain"> cte</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">aws_ec2_id </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> aws_ec2</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">id</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">INNER</span><span class="token plain"> </span><span class="token keyword" style="color:rgb(12, 150, 155)">JOIN</span><span class="token plain"> company_teams </span><span class="token keyword" style="color:rgb(12, 150, 155)">AS</span><span class="token plain"> ct </span><span class="token keyword" style="color:rgb(12, 150, 155)">ON</span><span class="token plain"> ct</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">id </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> cte</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">company_team_id</span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">WHERE</span><span class="token plain"> ct</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token plain">name </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(72, 118, 214)">'Data Engineering'</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Finally, your applications can know much more about what infrastructure they need than any auto-scaler solution out there. If you had a very infrequent but CPU/GPU-intensive job you need to handle at an unknown interval, you could give your application access to your IaSQL database and let it temporarily create and then destroy those resources.</p><div class="language-jsx codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#403f53;--prism-background-color:#FBFBFB"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-jsx codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#403f53"><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> ec2_instance_id </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">iasql</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token template-string string" style="color:rgb(72, 118, 214)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">  INSERT INTO aws_ec2 (ami_id, ec2_instance_type_id)</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">  SELECT ami.id, ait.id</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">  FROM ec2_instance_type as ait, (</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">      SELECT id</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">      FROM amis</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">      WHERE image_name = 'application-job-runner'</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">  ) as ami</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">  WHERE ait.instance_name = 'g3.4xlarge'</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">  RETURNING id;</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)"></span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword control-flow" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">iasql</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token template-string string" style="color:rgb(72, 118, 214)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">  INSERT INTO ec2_security_groups (ec2_id, security_group_id)</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">  SELECT </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(153, 76, 195)">${</span><span class="token template-string interpolation">ec2_instance_id</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token template-string string" style="color:rgb(72, 118, 214)">, sg.id</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">  FROM security_groups AS sg</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">  WHERE sg.name = 'application-job-group';</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)"></span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token comment" style="color:rgb(152, 159, 177);font-style:italic">// Only large-enough job runners will take it based on job metadata</span><span class="token plain"></span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword" style="color:rgb(12, 150, 155)">const</span><span class="token plain"> result </span><span class="token operator" style="color:rgb(12, 150, 155)">=</span><span class="token plain"> </span><span class="token keyword control-flow" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> job</span><span class="token punctuation" style="color:rgb(153, 76, 195)">.</span><span class="token method function property-access" style="color:rgb(153, 76, 195);font-style:italic">run</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token plain">myMassiveJob</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#403f53"><span class="token plain"></span><span class="token keyword control-flow" style="color:rgb(12, 150, 155)">await</span><span class="token plain"> </span><span class="token function" style="color:rgb(153, 76, 195);font-style:italic">iasql</span><span class="token punctuation" style="color:rgb(153, 76, 195)">(</span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token template-string string" style="color:rgb(72, 118, 214)"></span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">  DELETE FROM aws_ec2</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)">  WHERE id = </span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(153, 76, 195)">${</span><span class="token template-string interpolation">ec2_instance_id</span><span class="token template-string interpolation interpolation-punctuation punctuation" style="color:rgb(153, 76, 195)">}</span><span class="token template-string string" style="color:rgb(72, 118, 214)">;</span><br></span><span class="token-line" style="color:#403f53"><span class="token template-string string" style="color:rgb(72, 118, 214)"></span><span class="token template-string template-punctuation string" style="color:rgb(72, 118, 214)">`</span><span class="token punctuation" style="color:rgb(153, 76, 195)">)</span><span class="token punctuation" style="color:rgb(153, 76, 195)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="you-dont-need-to-learn-a-new-api-probably"><strong>You Don't Need to Learn a New API (Probably)</strong><a class="hash-link" href="#you-dont-need-to-learn-a-new-api-probably" title="Direct link to heading">​</a></h2><p>Nearly all cloud backend systems depend on a database, and most likely a SQL database, so you do not need to learn a new language to manipulate the infrastructure in this way.</p><p>And likely you're using a&nbsp;<a href="https://en.wikipedia.org/wiki/Schema_migration" target="_blank" rel="noopener noreferrer">migration system</a>&nbsp;in your backend to review changes to your database, which you can continue to use here, making it code to be reviewed, just like Infrastructure-as-Code.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="you-can-test-too"><strong>You Can Test, Too</strong><a class="hash-link" href="#you-can-test-too" title="Direct link to heading">​</a></h2><p>Since the safety guarantees are provided by the types and relations between tables, you can simply copy your production infrastructure database into a local database and run your changes/migration against that and verify it works before you run it on your actual Infrastructure-as-SQL database.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="recover-with-ease"><strong>Recover With Ease</strong><a class="hash-link" href="#recover-with-ease" title="Direct link to heading">​</a></h2><p>It's 3AM and your service has gone down. You reverted the most recent IaSQL migration, but that didn't resolve the issue, and you aren't sure which change across which service today caused the outage. So, you simply replace the state of the IaSQL database with a snapshot from yesterday to bring everything back online to a known-good-state, and then take your time after you're well-rested to figure out what actually went wrong.</p>]]></content:encoded>
        </item>
    </channel>
</rss>